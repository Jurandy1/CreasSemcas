<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de Inventário CREAS</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div id="root" class="container mx-auto p-4"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Dados iniciais do inventário
    const initialItems = [
      {"id":"1","description":"Ar-Condicionado Elbrus 12.000 BTU","unit_condition":"Bacanga","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"2","description":"Ar-Condicionado Elbrus 12.000 BTU","unit_condition":"Sol e Mar - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"3","description":"Ar-Condicionado Electrolux 18.000 BTU","unit_condition":"Centro - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"4","description":"Ar-Condicionado Elgin 12.000 BTU","unit_condition":"Centro","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"5","description":"Ar-Condicionado Elgin 12.000 BTU","unit_condition":"Sol e Mar","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"6","description":"Ar-Condicionado Elgin 12.000 BTU","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"7","description":"Ar-Condicionado Elgin 12.000 BTU","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"8","description":"Ar-Condicionado Consul 12.000 BTU","unit_condition":"Sol e Mar","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"9","description":"Ar-Condicionado HQ 9.000 BTU","unit_condition":"Sol e Mar","quantity":2,"state":"Novo","donation":"Não"},
      {"id":"10","description":"Ar-Condicionado HQ 9.000 BTU","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"11","description":"Ar-Condicionado Philco 18.000 BTU","unit_condition":"Cidade Operária","quantity":2,"state":"Novo","donation":"Não"},
      {"id":"12","description":"Ar-Condicionado Agratto 12.000 BTU","unit_condition":"Cidade Operária","quantity":2,"state":"Novo","donation":"Não"},
      {"id":"13","description":"Armário em Aço","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Sim"},
      {"id":"14","description":"Armário em Aço","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"15","description":"Armário em Aço","unit_condition":"Centro","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"16","description":"Armário em Aço","unit_condition":"Centro - Avariados","quantity":2,"state":"Avariado","donation":"Não"},
      {"id":"17","description":"Armário em Aço","unit_condition":"Sol e Mar","quantity":8,"state":"Bom","donation":"Sim"},
      {"id":"18","description":"Armário em Aço","unit_condition":"Cidade Operária","quantity":7,"state":"Bom","donation":"Não"},
      {"id":"19","description":"Armário em MDF","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Sim"},
      {"id":"20","description":"Armário em MDF","unit_condition":"Centro","quantity":1,"state":"Bom","donation":"Sim"},
      {"id":"21","description":"Armário em MDF","unit_condition":"Sol e Mar","quantity":2,"state":"Bom","donation":"Sim"},
      {"id":"22","description":"Arquivo em Aço","unit_condition":"Bacanga","quantity":3,"state":"Bom","donation":"Não"},
      {"id":"23","description":"Arquivo em Aço","unit_condition":"Bacanga - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"24","description":"Arquivo em Aço","unit_condition":"Centro","quantity":6,"state":"Bom","donation":"Não"},
      {"id":"25","description":"Arquivo em Aço","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"26","description":"Bebedouro de Coluna","unit_condition":"Sol e Mar","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"27","description":"Bebedouro de Coluna Esmaltec","unit_condition":"Centro","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"28","description":"Bebedouro de Coluna Esmaltec","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"29","description":"Cadeira de Plástico","unit_condition":"Bacanga","quantity":24,"state":"Bom","donation":"Não"},
      {"id":"30","description":"Cadeira de Plástico","unit_condition":"Centro","quantity":6,"state":"Bom","donation":"Não"},
      {"id":"31","description":"Cadeira de Plástico","unit_condition":"Cidade Operária","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"32","description":"Cadeira de Plástico Branca","unit_condition":"Bacanga","quantity":32,"state":"Bom","donation":"Não"},
      {"id":"33","description":"Cadeira de Plástico Branca","unit_condition":"Centro","quantity":6,"state":"Bom","donation":"Não"},
      {"id":"34","description":"Cadeira de Plástico Branca","unit_condition":"Sol e Mar","quantity":8,"state":"Bom","donation":"Não"},
      {"id":"35","description":"Cadeira de Plástico Branca","unit_condition":"Cidade Operária","quantity":8,"state":"Bom","donation":"Não"},
      {"id":"36","description":"Cadeira de Plástico Verde","unit_condition":"Bacanga","quantity":16,"state":"Bom","donation":"Não"},
      {"id":"37","description":"Cadeira de Plástico Verde (Atendimento)","unit_condition":"Bacanga","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"38","description":"Cadeira de Plástico Verde (Usuário)","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"39","description":"Cadeira de Plástico Infantil","unit_condition":"Bacanga","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"40","description":"Cadeira de Plástico Infantil","unit_condition":"Centro","quantity":6,"state":"Bom","donation":"Não"},
      {"id":"41","description":"Cadeira de Plástico Infantil","unit_condition":"Sol e Mar","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"42","description":"Cadeira de Plástico Infantil","unit_condition":"Cidade Operária","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"43","description":"Cadeira Palito","unit_condition":"Bacanga","quantity":3,"state":"Bom","donation":"Sim"},
      {"id":"44","description":"Cadeira Palito","unit_condition":"Centro","quantity":2,"state":"Regular","donation":"Não"},
      {"id":"45","description":"Cadeira Palito","unit_condition":"Centro","quantity":3,"state":"Bom","donation":"Não"},
      {"id":"46","description":"Cadeira Palito","unit_condition":"Cidade Operária","quantity":4,"state":"Bom","donation":"Não"},
      {"id":"47","description":"Cadeira Palito Preta","unit_condition":"Centro","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"48","description":"Cadeira Palito Preta","unit_condition":"Centro - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"49","description":"Cadeira Palito Preta","unit_condition":"Centro","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"50","description":"Cadeira de Palhinha","unit_condition":"Cidade Operária","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"51","description":"Cadeira em Polímero Azul","unit_condition":"Centro","quantity":3,"state":"Bom","donation":"Sim"},
      {"id":"52","description":"Cadeira em Polímero Azul","unit_condition":"Centro","quantity":3,"state":"Regular","donation":"Sim"},
      {"id":"53","description":"Cadeira em Polímero Azul","unit_condition":"Sol e Mar","quantity":38,"state":"Bom","donation":"Sim"},
      {"id":"54","description":"Cadeira em Polímero Preta","unit_condition":"Sol e Mar","quantity":15,"state":"Bom","donation":"Sim"},
      {"id":"55","description":"Cadeira Giratória Azul","unit_condition":"Centro","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"56","description":"Cadeira Giratória Azul","unit_condition":"Centro - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"57","description":"Cadeira Giratória Azul","unit_condition":"Cidade Operária","quantity":6,"state":"Bom","donation":"Não"},
      {"id":"58","description":"Cadeira Giratória Azul","unit_condition":"Cidade Operária - Avariados","quantity":2,"state":"Avariado","donation":"Não"},
      {"id":"59","description":"Cadeira Tipo Presidente Preta","unit_condition":"Bacanga","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"60","description":"Cadeira Presidente","unit_condition":"Sol e Mar","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"61","description":"Cadeira","unit_condition":"Cidade Operária - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"62","description":"Longarina Preta 3 Lugares","unit_condition":"Sol e Mar","quantity":4,"state":"Bom","donation":"Sim"},
      {"id":"63","description":"Longarina 5 Lugares","unit_condition":"Cidade Operária","quantity":3,"state":"Novo","donation":"Não"},
      {"id":"64","description":"Longarina 3 Lugares Azul","unit_condition":"Cidade Operária","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"65","description":"Longarina 3 Lugares Azul","unit_condition":"Cidade Operária","quantity":2,"state":"Regular","donation":"Não"},
      {"id":"66","description":"Computador Positivo","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"67","description":"CPU Positivo Completo","unit_condition":"Cidade Operária","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"68","description":"Estante em Aço","unit_condition":"Bacanga","quantity":4,"state":"Regular","donation":"Não"},
      {"id":"69","description":"Estante em Aço","unit_condition":"Centro","quantity":2,"state":"Regular","donation":"Não"},
      {"id":"70","description":"Estante em Aço","unit_condition":"Centro - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"71","description":"Estante em Aço","unit_condition":"Cidade Operária","quantity":5,"state":"Bom","donation":"Não"},
      {"id":"72","description":"Fogão 4 Bocas","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"73","description":"Fogão 4 Bocas","unit_condition":"Centro","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"74","description":"Fogão 4 Bocas","unit_condition":"Sol e Mar","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"75","description":"Fogão 4 Bocas","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"76","description":"Geladeira Esmaltec","unit_condition":"Bacanga","quantity":2,"state":"Novo","donation":"Não"},
      {"id":"77","description":"Geladeira Esmaltec","unit_condition":"Centro","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"78","description":"Geladeira Esmaltec","unit_condition":"Sol e Mar","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"79","description":"Geladeira Esmaltec","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"80","description":"Frigobar","unit_condition":"Cidade Operária","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"81","description":"Impressora OfficeJet Pro 8600","unit_condition":"Centro - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"82","description":"Impressora Brother HL1202","unit_condition":"Sol e Mar - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"83","description":"Mesa para Escritório","unit_condition":"Bacanga - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"84","description":"Mesa para Escritório","unit_condition":"Centro","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"85","description":"Mesa para Escritório","unit_condition":"Centro - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"86","description":"Mesa para Escritório","unit_condition":"Sol e Mar","quantity":3,"state":"Novo","donation":"Não"},
      {"id":"87","description":"Mesa para Escritório","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Sim"},
      {"id":"88","description":"Mesa para Escritório","unit_condition":"Cidade Operária","quantity":3,"state":"Novo","donation":"Não"},
      {"id":"89","description":"Mesa para Escritório","unit_condition":"Cidade Operária","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"90","description":"Mesa para Escritório (Atendimento)","unit_condition":"Bacanga","quantity":5,"state":"Bom","donation":"Não"},
      {"id":"91","description":"Mesa para Escritório (Atendimento)","unit_condition":"Bacanga","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"92","description":"Mesa para Escritório (Atendimento)","unit_condition":"Cidade Operária","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"93","description":"Mesa para Escritório com 2 Gavetas","unit_condition":"Bacanga - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"94","description":"Mesa para Escritório com 2 Gavetas","unit_condition":"Centro","quantity":3,"state":"Bom","donation":"Não"},
      {"id":"95","description":"Mesa para Escritório com 2 Gavetas","unit_condition":"Centro","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"96","description":"Mesa para Escritório com 2 Gavetas","unit_condition":"Sol e Mar","quantity":3,"state":"Bom","donation":"Sim"},
      {"id":"97","description":"Mesa para Escritório com 2 Gavetas","unit_condition":"Cidade Operária","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"98","description":"Mesa para Escritório com 2 Gavetas (Atendimento)","unit_condition":"Centro","quantity":2,"state":"Regular","donation":"Sim"},
      {"id":"99","description":"Mesa para Escritório com 3 Gavetas","unit_condition":"Sol e Mar","quantity":2,"state":"Novo","donation":"Não"},
      {"id":"100","description":"Mesa para Escritório com 3 Gavetas","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"101","description":"Mesa para Digitador","unit_condition":"Cidade Operária","quantity":3,"state":"Bom","donation":"Não"},
      {"id":"102","description":"Mesa de Plástico","unit_condition":"Centro","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"103","description":"Mesa de Plástico","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"104","description":"Mesa de Plástico Branca","unit_condition":"Bacanga","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"105","description":"Mesa de Plástico Branca","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"106","description":"Mesa de Plástico Branca","unit_condition":"Cidade Operária","quantity":2,"state":"Bom","donation":"Não"},
      {"id":"107","description":"Mesa de Plástico Infantil","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"108","description":"Mesa de Plástico Infantil","unit_condition":"Centro","quantity":3,"state":"Bom","donation":"Não"},
      {"id":"109","description":"Mesa de Plástico Infantil","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"110","description":"Mesa de Plástico Infantil","unit_condition":"Cidade Operária","quantity":4,"state":"Bom","donation":"Não"},
      {"id":"111","description":"Mesa em L","unit_condition":"Bacanga","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"112","description":"Mesa em L","unit_condition":"Sol e Mar","quantity":2,"state":"Novo","donation":"Não"},
      {"id":"113","description":"Mesa para Computador","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"114","description":"Mesa Redonda","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"115","description":"Mesa Redonda","unit_condition":"Cidade Operária","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"116","description":"Mesa Redonda (Atendimento)","unit_condition":"Centro - Avariados","quantity":1,"state":"Avariado","donation":"Não"},
      {"id":"117","description":"Mesa para Reunião","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Sim"},
      {"id":"118","description":"Mesa Tipo Reunião","unit_condition":"Cidade Operária","quantity":1,"state":"Regular","donation":"Não"},
      {"id":"119","description":"Ponto Eletrônico","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"120","description":"Ponto Eletrônico","unit_condition":"Sol e Mar","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"121","description":"Televisão HQ","unit_condition":"Bacanga","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"122","description":"Televisão HQ","unit_condition":"Centro","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"123","description":"Televisão HQ","unit_condition":"Sol e Mar","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"124","description":"Televisão HQ","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"125","description":"Totem","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"126","description":"Ventilador de Coluna","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"127","description":"Ventilador de Parede","unit_condition":"Bacanga","quantity":1,"state":"Bom","donation":"Não"},
      {"id":"128","description":"Ventilador de Parede","unit_condition":"Centro","quantity":3,"state":"Novo","donation":"Não"},
      {"id":"129","description":"Ventilador de Parede","unit_condition":"Sol e Mar","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"130","description":"Rack","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"131","description":"Switch","unit_condition":"Cidade Operária","quantity":1,"state":"Novo","donation":"Não"},
      {"id":"132","description":"Quadro Branco","unit_condition":"Cidade Operária","quantity":4,"state":"Bom","donation":"Não"},
      {"id":"133","description":"Nobreak","unit_condition":"Cidade Operária","quantity":1,"state":"Bom","donation":"Sim"}
    ];

    function InventoryApp() {
      const [items, setItems] = useState(initialItems);
      const [filter, setFilter] = useState('');
      const [sortConfig, setSortConfig] = useState({ key: null, direction: 'ascending' });
      const [activeTab, setActiveTab] = useState('Bacanga');

      // Definir referências para gráficos
      const chartRefs = {
        bacanga: useRef(null),
        centro: useRef(null),
        solemar: useRef(null),
        cidadeoperaria: useRef(null),
        unitPie: useRef(null),
        categorySummary: useRef(null)
      };

      // Carregar itens do localStorage
      useEffect(() => {
        try {
          const savedItems = localStorage.getItem('inventory');
          if (savedItems) {
            setItems(JSON.parse(savedItems));
          }
        } catch (e) {
          console.error('Erro ao carregar do localStorage:', e);
        }
      }, []);

      // Salvar itens no localStorage
      useEffect(() => {
        try {
          localStorage.setItem('inventory', JSON.stringify(items));
        } catch (e) {
          console.error('Erro ao salvar no localStorage:', e);
        }
      }, [items]);

      // Inicializar gráficos
      useEffect(() => {
        const units = ['Bacanga', 'Centro', 'Sol e Mar', 'Cidade Operária'];
        const stateOrder = ['Novo', 'Bom', 'Regular', 'Avariado'];

        // Gráficos de barras por unidade
        const charts = units.map(unit => {
          const stateCounts = items
            .filter(item => item.unit_condition.includes(unit))
            .reduce((acc, item) => {
              acc[item.state] = (acc[item.state] || 0) + parseInt(item.quantity);
              return acc;
            }, {});
          
          const chartRefKey = unit.toLowerCase().replace(' ', '');
          if (!chartRefs[chartRefKey] || !chartRefs[chartRefKey].current) {
            console.warn(`Referência para ${chartRefKey} não encontrada ou <canvas> não renderizado.`);
            return null;
          }

          return new Chart(chartRefs[chartRefKey].current, {
            type: 'bar',
            data: {
              labels: stateOrder,
              datasets: [{
                label: `Quantidade de Itens - ${unit}`,
                data: stateOrder.map(state => stateCounts[state] || 0),
                backgroundColor: stateOrder.map(state => 
                  state === 'Novo' ? '#15803D' : 
                  state === 'Avariado' ? '#B91C1C' : 
                  state === 'Regular' ? '#FBBF24' : '#34D399'
                ),
                borderColor: stateOrder.map(state => 
                  state === 'Novo' ? '#166534' : 
                  state === 'Avariado' ? '#991B1B' : 
                  state === 'Regular' ? '#F59E0B' : '#10B981'
                ),
                borderWidth: 1
              }]
            },
            options: {
              plugins: { title: { display: true, text: `Itens por Estado - ${unit}` } },
              scales: { y: { beginAtZero: true, title: { display: true, text: 'Quantidade' } } }
            }
          });
        }).filter(chart => chart !== null);

        // Gráfico de pizza: Itens por unidade
        const unitCounts = items.reduce((acc, item) => {
          const unit = item.unit_condition.split(' - ')[0];
          acc[unit] = (acc[unit] || 0) + parseInt(item.quantity);
          return acc;
        }, {});
        const unitPieChart = chartRefs.unitPie.current && new Chart(chartRefs.unitPie.current, {
          type: 'pie',
          data: {
            labels: units,
            datasets: [{
              data: units.map(unit => unitCounts[unit] || 0),
              backgroundColor: ['#34D399', '#3B82F6', '#FBBF24', '#EF4444']
            }]
          },
          options: { plugins: { title: { display: true, text: 'Distribuição de Itens por Unidade' } } }
        });

        // Gráfico de barras: Resumo por Categoria (Regular e Avariado)
        const categoryCounts = units.reduce((acc, unit) => {
          acc[unit] = items
            .filter(item => item.unit_condition.includes(unit))
            .reduce((subAcc, item) => {
              if (item.state === 'Regular' || item.state === 'Avariado') {
                subAcc[item.state] = (subAcc[item.state] || 0) + parseInt(item.quantity);
              }
              return subAcc;
            }, { Regular: 0, Avariado: 0 });
          return acc;
        }, {});
        const categorySummaryChart = chartRefs.categorySummary.current && new Chart(chartRefs.categorySummary.current, {
          type: 'bar',
          data: {
            labels: units,
            datasets: [
              {
                label: 'Regular',
                data: units.map(unit => categoryCounts[unit].Regular || 0),
                backgroundColor: '#FBBF24',
                borderColor: '#F59E0B',
                borderWidth: 1
              },
              {
                label: 'Avariado',
                data: units.map(unit => categoryCounts[unit].Avariado || 0),
                backgroundColor: '#B91C1C',
                borderColor: '#991B1B',
                borderWidth: 1
              }
            ]
          },
          options: {
            plugins: { title: { display: true, text: 'Itens Regulares e Avariados por Unidade' } },
            scales: { y: { beginAtZero: true, title: { display: true, text: 'Quantidade' } } }
          }
        });

        return () => {
          charts.forEach(chart => chart && chart.destroy());
          unitPieChart && unitPieChart.destroy();
          categorySummaryChart && categorySummaryChart.destroy();
        };
      }, [items]);

      // Filtrar itens por unidade ou categoria
      const getFilteredItems = (filterType, value) => {
        return items
          .filter(item => {
            if (filterType === 'unit') {
              return item.unit_condition.includes(value);
            } else if (filterType === 'category') {
              return item.state === value;
            }
            return true;
          })
          .filter(item =>
            Object.values(item).some(val =>
              val.toString().toLowerCase().includes(filter.toLowerCase())
            )
          );
      };

      // Ordenar itens
      const getSortedItems = (filteredItems) => {
        return [...filteredItems].sort((a, b) => {
          if (!sortConfig.key) return 0;
          const aValue = a[sortConfig.key];
          const bValue = b[sortConfig.key];
          if (aValue < bValue) return sortConfig.direction === 'ascending' ? -1 : 1;
          if (aValue > bValue) return sortConfig.direction === 'ascending' ? 1 : -1;
          return 0;
        });
      };

      // Ordenar tabela
      const handleSort = (key) => {
        let direction = 'ascending';
        if (sortConfig.key === key && sortConfig.direction === 'ascending') {
          direction = 'descending';
        }
        setSortConfig({ key, direction });
      };

      // Exportar para CSV
      const exportToCSV = (name, filteredItems) => {
        const headers = ['Descrição,Unidade_Condição,Quantidade,Estado,Doação'];
        const csvRows = filteredItems.map(item =>
          `"${item.description}","${item.unit_condition}",${item.quantity},"${item.state}","${item.donation}"`
        );
        const csvContent = headers.concat(csvRows).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `inventario_creas_${name.toLowerCase().replace(' ', '_')}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      return (
        <div className="max-w-6xl mx-auto">
          {/* Banner */}
          <div className="mb-6">
            <img
              src="https://via.placeholder.com/1280x160.png?text=CREAS+Banner"
              alt="Banner Painel de Inventário CREAS"
              className="w-full h-32 md:h-40 object-cover rounded-lg shadow-md"
            />
          </div>

          <h1 className="text-3xl font-bold text-center mb-6">Painel de Inventário CREAS</h1>

          {/* Filtro Geral */}
          <div className="mb-6">
            <input
              type="text"
              value={filter}
              onChange={(e) => setFilter(e.target.value)}
              placeholder="Filtrar por qualquer campo"
              className="border p-2 rounded w-full md:w-1/2"
            />
          </div>

          {/* Abas */}
          <div className="mb-6">
            <div className="flex border-b">
              {['Bacanga', 'Centro', 'Sol e Mar', 'Cidade Operária', 'Resumo por Categoria'].map(tab => (
                <button
                  key={tab}
                  className={`px-4 py-2 -mb-px border-b-2 ${activeTab === tab ? 'border-blue-500 text-blue-500' : 'border-transparent text-gray-600'} hover:text-blue-500 hover:border-blue-500`}
                  onClick={() => setActiveTab(tab)}
                >
                  {tab}
                </button>
              ))}
            </div>
          </div>

          {/* Conteúdo das Abas */}
          {activeTab === 'Resumo por Categoria' ? (
            <div className="mb-8">
              <h2 className="text-2xl font-semibold mb-4">Resumo por Categoria</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                <div className="bg-white p-4 rounded-lg shadow-md">
                  <canvas id="categorySummary" ref={chartRefs.categorySummary}></canvas>
                </div>
                <div className="bg-white p-4 rounded-lg shadow-md">
                  <button
                    onClick={() => exportToCSV('Resumo_Categoria', getFilteredItems('category', 'Regular').concat(getFilteredItems('category', 'Avariado')))}
                    className="bg-green-500 text-white p-2 rounded hover:bg-green-600 mb-4"
                  >
                    Exportar para CSV
                  </button>
                  {['Regular', 'Avariado'].map(category => (
                    <div key={category} className="mb-4">
                      <h3 className="text-xl font-medium mb-2">{`Itens ${category}`}</h3>
                      {getSortedItems(getFilteredItems('category', category)).length === 0 ? (
                        <p className="text-gray-500">Nenhum item encontrado.</p>
                      ) : (
                        <table className="w-full border-collapse">
                          <thead>
                            <tr className="bg-gray-200">
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('description')}>
                                Descrição {sortConfig.key === 'description' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('unit_condition')}>
                                Unidade/Condição {sortConfig.key === 'unit_condition' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('quantity')}>
                                Quantidade {sortConfig.key === 'quantity' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('state')}>
                                Estado {sortConfig.key === 'state' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('donation')}>
                                Doação {sortConfig.key === 'donation' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            {getSortedItems(getFilteredItems('category', category)).map(item => (
                              <tr
                                key={item.id}
                                className={`hover:bg-gray-100 ${item.state === 'Regular' ? 'bg-yellow-100' : 'bg-red-100'}`}
                              >
                                <td className="border p-2">{item.description}</td>
                                <td className="border p-2">{item.unit_condition}</td>
                                <td className="border p-2">{item.quantity}</td>
                                <td className="border p-2">{item.state}</td>
                                <td className="border p-2">{item.donation}</td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            <>
              {/* Gráfico de Pizza (apenas para unidades) */}
              <div className="grid grid-cols-1 md:grid-cols-1 gap-6 mb-6">
                <div className="bg-white p-4 rounded-lg shadow-md">
                  <canvas id="unitPie" ref={chartRefs.unitPie}></canvas>
                </div>
              </div>

              {/* Seções por Unidade */}
              {['Bacanga', 'Centro', 'Sol e Mar', 'Cidade Operária'].map(unit => (
                <div key={unit} className={`mb-8 ${activeTab !== unit ? 'hidden' : ''}`}>
                  <h2 className="text-2xl font-semibold mb-4">{`CREAS ${unit}`}</h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                    <div className="bg-white p-4 rounded-lg shadow-md">
                      <canvas id={unit.toLowerCase().replace(' ', '')} ref={chartRefs[unit.toLowerCase().replace(' ', '')]}></canvas>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-md">
                      <button
                        onClick={() => exportToCSV(unit, getFilteredItems('unit', unit))}
                        className="bg-green-500 text-white p-2 rounded hover:bg-green-600 mb-4"
                      >
                        Exportar para CSV
                      </button>
                      {getSortedItems(getFilteredItems('unit', unit)).length === 0 ? (
                        <p className="text-gray-500">Nenhum item encontrado.</p>
                      ) : (
                        <table className="w-full border-collapse">
                          <thead>
                            <tr className="bg-gray-200">
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('description')}>
                                Descrição {sortConfig.key === 'description' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('unit_condition')}>
                                Unidade/Condição {sortConfig.key === 'unit_condition' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('quantity')}>
                                Quantidade {sortConfig.key === 'quantity' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('state')}>
                                Estado {sortConfig.key === 'state' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                              <th className="border p-2 cursor-pointer" onClick={() => handleSort('donation')}>
                                Doação {sortConfig.key === 'donation' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                              </th>
                            </tr>
                          </thead>
                          <tbody>
                            {getSortedItems(getFilteredItems('unit', unit)).map(item => (
                              <tr
                                key={item.id}
                                className={`hover:bg-gray-100 ${item.state === 'Regular' ? 'bg-yellow-100' : item.state === 'Avariado' ? 'bg-red-100' : ''}`}
                              >
                                <td className="border p-2">{item.description}</td>
                                <td className="border p-2">{item.unit_condition}</td>
                                <td className="border p-2">{item.quantity}</td>
                                <td className="border p-2">{item.state}</td>
                                <td className="border p-2">{item.donation}</td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </>
          )}
        </div>
      );
    }

    if (window.ReactDOM) {
      ReactDOM.render(<InventoryApp />, document.getElementById('root'));
    } else {
      console.error('ReactDOM não carregado.');
      document.getElementById('root').innerHTML = '<p class="text-red-500 text-center">Erro ao carregar o painel. Verifique sua conexão com a internet.</p>';
    }
  </script>
</body>
</html>